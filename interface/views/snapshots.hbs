<script src="javascripts/qrcode.min.js" type="text/javascript"></script>

<header id="header" class="bg-dark p-4 mb-4">
    <h1 class="display-5 fw-bold">The Photo Album</h1>
    <p class="lead">
        {{title}}
    </p> 
</header>

<section>
<div class="container-fluid">
	<ul id="snapshots" class="list-group list-group-flush">
	</ul>
</div>
</section> 

<section id="footer">
</section>

<script>
    let socket = io('/history');  
    let keyboard;
   
    document.addEventListener("DOMContentLoaded", event => {
        socket.on('start up', initializeScreen); 
        socket.on('update', updateScreen); 

        keyboard = new window.keypress.Listener();
        keyboard.simple_combo("shift m", () => {
            toggleHeader();
        });        
    });

    function toggleHeader() {
        let header = document.getElementById('header');
        if (header.style.display != 'none') {
            header.style.display = 'none';
        } else {
            header.style.display = 'block';
        }    
    }

    function initializeScreen(settings) {
        settings.snapshots.forEach(s => {
            appendSnapshot(s);
        })
    }

    function updateScreen(settings) {
        let snapshot = _.last(settings.snapshots);
        appendSnapshot(snapshot);
    }

    function appendSnapshot(snapshot) {
        let imageURL = `${window.location.protocol}//${window.location.hostname}${snapshot.path}/${snapshot.filename}`
        
        let i = document.createElement('img');
        i.className = 'float-start img-fluid w-75 p-3';
        i.setAttribute('src', imageURL);

        let qr = document.createElement('span');
        qr.className = 'float-start p-3';
        new QRCode(qr, {
            text: imageURL,
            width: 200,
            height: 200,
            colorDark : "#000000",
            colorLight : "#cccccc",
            correctLevel : QRCode.CorrectLevel.H
        });        

        let timestamp = document.createElement('div');
        timestamp.innerText = snapshot.timestamp;

        let item = document.createElement('li');
        item.className = 'list-group-item';
        item.appendChild(i);
        item.appendChild(qr);
        item.appendChild(timestamp);
        document.getElementById("snapshots").appendChild(item);
    }
</script>